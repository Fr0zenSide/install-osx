# unbind C-b
# set -g prefix C-a

# Upgrade $TERM
# Set 256 colors
set-option -g  default-terminal "screen-256color"
set-option -s  default-terminal 'tmux-256color'
set-option -sa terminal-overrides ",alacritty:RGB"
#set-option -g  detach-on-destroy off
# tmux messages are displayed for 4 seconds
tmux set-option -g display-time 4000

# Start windows and panes at 1, not 0
set -g  base-index 1
setw -g pane-base-index 1
#set -g pane-border-status top
#set -g pane-border-status off
set -g  history-limit 1000000 # very large history
set -g  renumber-windows on
# super useful when using "grouped sessions" and multi-monitor setup
set-window-option -g aggressive-resize on
set -gs escape-time 0

set -g  focus-events on
set -g  status-keys emacs

# activate for macOS copy & paste
set-option -g default-command "reattach-to-user-namespace -l zsh"

unbind r
bind r source-file ~/.tmux.conf

unbind ^B
bind ^B select-pane -t :.+

bind - split-window -v
bind / split-window -h


set -g mouse on

# macOS only
#bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
#bind -n WheelDownPane select-pane -t= \; send-keys -M
#bind -n C-WheelUpPane select-pane -t= \; copy-mode -e \; send-keys -M
#bind -T copy-mode-emacs C-WheelUpPane   send-keys -X halfpage-up
#bind -T copy-mode-emacs C-WheelDownPane send-keys -X halfpage-down


# Come from an article with vi-mode activated so need to try before any thing
# copy from tmux to clipboard
# bind-key -T copy-mode-vi y send-keys -X copy-pipe "xclip -r" \; display-message "Copied to selection"
# bind-key -T copy-mode-vi Y send-keys -X copy-pipe "xclip -r -selection clipboard" \; display-message "Copied to clipboard"
# bind-key C-p run-shell "xclip -o | tmux load-buffer - && tmux paste-buffer"


# install tmux package manager:
# `git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm`
# Reload tmux conf => `tmux source ~/.tmux.conf` or `prefix` + r // in this setup
# Launch any installation `prefix` + I (capital i)
# cf. https://github.com/mamyn0va/tmux-dracula/blob/master/.tmux.conf.local l.300
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'

# persist tmux sessions after computer restart
set -g @plugin 'tmux-plugins/tmux-resurrect'
# automatically saves sessions for you every 15 minutes
set -g @plugin 'tmux-plugins/tmux-continuum'

# Dracula theme
set -g @plugin 'dracula/tmux'

set -g @dracula-show-powerline true
set -g @dracula-show-left-icon session
set -g @dracula-show-flags true

set -g @dracula-plugins "cpu-usage ram-usage"

# Override Dracula theme
#set -g @dracula-powerline top
#set -g status-position top
# tmux_conf_copy_to_os_clipboard=true
set -g set-clipboard on


# switch panes using Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# swap windows with shift+arrow with prefix
bind-key S-Left swap-window -t -1
bind-key S-Right swap-window -t +1

# restore vim sessions
# set -g @resurrect-strategy-vim 'session'
# restore neovim sessions
# set -g @resurrect-strategy-nvim 'session'
# Can we find a similar setup for emacs ??? 
# restore panes
set -g @resurrect-capture-pane-contents 'on'
# restore last saved environment (automatically)
set -g @continuum-restore 'on'

#run-shell ~/.tmux/plugins/tmux-sensible/sensible.tmux
# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
